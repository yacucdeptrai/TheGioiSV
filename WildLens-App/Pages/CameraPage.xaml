<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="WildLensApp.Pages.CameraPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
    xmlns:viewmodels="clr-namespace:WildLensApp.ViewModels"
    Title="Camera">

    <Grid RowDefinitions="Auto,*,Auto" ColumnDefinitions="*">
        <HorizontalStackLayout Spacing="12" Padding="12">
            <Button Text="Pick Image" Clicked="OnPickImageClicked"/>
            <Label Text="Tap a box to select" VerticalOptions="Center"/>
        </HorizontalStackLayout>

        <Grid Grid.Row="1">
            <Grid.RowDefinitions>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            <!-- Live camera preview (requires device/emulator with camera). -->
            <toolkit:CameraView x:Name="Camera" Grid.Row="0" 
                                HorizontalOptions="Fill" VerticalOptions="Fill"
                                CaptureMode="Preview" 
                                IsPreviewing="True"/>

            <!-- Overlay for detection boxes -->
            <GraphicsView x:Name="Overlay" Grid.Row="0"
                          HorizontalOptions="Fill" VerticalOptions="Fill"
                          Drawable="{Binding Source={x:Reference Name=Overlay}, Path=BindingContext}"
                          />
            <Grid.GestureRecognizers>
                <TapGestureRecognizer Tapped="OnOverlayTapped" NumberOfTapsRequired="1"/>
            </Grid.GestureRecognizers>
        </Grid>

        <Grid Grid.Row="2" Padding="12">
            <CollectionView ItemsSource="{Binding Detections}" HeightRequest="120" SelectionMode="Single" SelectedItem="{Binding SelectedDetection}">
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <HorizontalStackLayout Spacing="8">
                            <Label Text="{Binding Label}" FontAttributes="Bold"/>
                            <Label Text="{Binding Confidence, StringFormat='{}{0:P0}'}"/>
                        </HorizontalStackLayout>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </Grid>
    </Grid>
</ContentPage>